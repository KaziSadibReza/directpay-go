import{r as e,g as t,R as n,j as o,c as r}from"./client-C4Hiuctl.js";import{C as a}from"./CustomDropdown-0EZoAZdu.js";const s={},i=e=>{let t;const n=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,a={setState:o,getState:r,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!==(s?"production":void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},i=t=e(o,r,a);return a};var l={exports:{}},c={},d={exports:{}},p={},u=e;var m="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},h=u.useState,y=u.useEffect,g=u.useLayoutEffect,_=u.useDebugValue;function f(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!m(e,n)}catch(o){return!0}}var v="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=h({inst:{value:n,getSnapshot:t}}),r=o[0].inst,a=o[1];return g(function(){r.value=n,r.getSnapshot=t,f(r)&&a({inst:r})},[e,n,t]),y(function(){return f(r)&&a({inst:r}),e(function(){f(r)&&a({inst:r})})},[e]),_(n),n};p.useSyncExternalStore=void 0!==u.useSyncExternalStore?u.useSyncExternalStore:v,d.exports=p;var x=d.exports,b=e,w=x;
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},k=w.useSyncExternalStore,C=b.useRef,N=b.useEffect,S=b.useMemo,P=b.useDebugValue;c.useSyncExternalStoreWithSelector=function(e,t,n,o,r){var a=C(null);if(null===a.current){var s={hasValue:!1,value:null};a.current=s}else s=a.current;a=S(function(){function e(e){if(!l){if(l=!0,a=e,e=o(e),void 0!==r&&s.hasValue){var t=s.value;if(r(t,e))return i=t}return i=e}if(t=i,j(a,e))return t;var n=o(e);return void 0!==r&&r(t,n)?(a=e,t):(a=e,i=n)}var a,i,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,o,r]);var i=k(e,a[0],a[1]);return N(function(){s.hasValue=!0,s.value=i},[i]),P(i),i},l.exports=c;const E=t(l.exports),L={},{useDebugValue:M}=n,{useSyncExternalStoreWithSelector:T}=E;let I=!1;const O=e=>e;const A=e=>{"production"!==(L?"production":void 0)&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?i(e):i)(e):e,n=(e,n)=>function(e,t=O,n){"production"!==(L?"production":void 0)&&n&&!I&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),I=!0);const o=T(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return M(o),o}(t,e,n);return Object.assign(n,t),n},D={en:{reference_label:"Order Reference",reference_placeholder:"Enter order reference",amount_label:"Amount",amount_placeholder:"0.00",email_label:"Email",email_placeholder:"your@email.com",first_name_label:"First Name",first_name_placeholder:"John",last_name_label:"Last Name",last_name_placeholder:"Doe",address_label:"Address",address_placeholder:"Street address",city_label:"City",city_placeholder:"City name",postcode_label:"Postal Code",postcode_placeholder:"12345",country_label:"Country",phone_label:"Phone",phone_placeholder:"+1 234 567 8900",order_details:"Order Details",customer_information:"Customer Information",shipping_method_label:"Shipping Method",payment_method_label:"Payment Method",order_summary:"Order Summary",subtotal:"Subtotal",shipping:"Shipping",total:"Total",free:"Free",place_order_button:"Place Order",processing:"Processing...",enter_address_for_shipping:"Please enter your postal code and city to see available shipping methods.",no_payment_methods:"No payment methods available.",loading_payment_methods:"Loading payment methods...",select_payment_method:"Select Payment Method",order_success_title:"Order Created Successfully!",order_number:"Order Number",reference:"Reference",payment_method:"Payment Method",status:"Status",required_field:"This field is required",invalid_email:"Please enter a valid email address",invalid_amount:"Amount must be greater than zero",bacs_description:"Make your payment directly into our bank account.",bacs_reference:"Please use your Order ID as the payment reference.",bacs_cleared:"Your order will not be shipped until the funds have cleared in our account.",check_send_to:"Please send a check to",cod_description:"Pay with cash upon delivery.",card_number:"Card Number",expiry_date:"Expiry Date",card_code:"Card Code",cvc:"CVC",select_pickup_location:"Select Your Pickup Location",choose_shipping_provider:"Choose Shipping Provider",choose_delivery_speed:"Choose Delivery Speed",express_delivery:"Express Delivery",normal_delivery:"Normal Delivery",select_pickup_point:"Select Pickup Point",choose_nearest_pickup:"Choose your nearest pickup point...",no_locations_available:"No pickup locations available in your country for this provider.",try_different_provider:"Try selecting a different provider or check if your country is supported.",loading_locations:"Loading locations...",shipping_manager:"Shipping Manager",manage_shipping:"Manage your shipping locations and pricing",add_location:"Add Location",save_changes:"Save Changes",location_name:"Location Name",express_price:"Express Price",normal_price:"Normal Price",delete_location:"Delete Location",confirm_delete:"Are you sure you want to delete this location?",active_sessions:"Active Shipping Sessions",session_id:"Session ID",customer:"Customer",expires:"Expires",actions:"Actions",view_details:"View Details",no_sessions:"No active sessions",languages:"Languages",installed:"Installed",not_installed:"Not Installed",download:"Download",download_all:"Download All Missing",first_order_benefits:"First Order Benefits",free_shipping_after_first:"After your first order, enjoy",free_shipping_badge:"FREE SHIPPING",free_shipping_duration:"on additional orders for the next 5 hours!",free_shipping_active:"Free Shipping Active!",order_in_session:"Order",in_this_session:"in this session",saved:"Saved",end_session:"End session",confirm_end_session:"Are you sure you want to end your free shipping session?"},fr:{reference_label:"R√©f√©rence de commande",reference_placeholder:"Entrez la r√©f√©rence",amount_label:"Montant",amount_placeholder:"0.00",email_label:"E-mail",email_placeholder:"votre@email.com",first_name_label:"Pr√©nom",first_name_placeholder:"Jean",last_name_label:"Nom",last_name_placeholder:"Dupont",address_label:"Adresse",address_placeholder:"Adresse de rue",city_label:"Ville",city_placeholder:"Nom de la ville",postcode_label:"Code postal",postcode_placeholder:"75001",country_label:"Pays",phone_label:"T√©l√©phone",phone_placeholder:"+33 1 23 45 67 89",order_details:"D√©tails de la commande",customer_information:"Informations client",shipping_method_label:"M√©thode de livraison",payment_method_label:"M√©thode de paiement",order_summary:"R√©capitulatif",subtotal:"Sous-total",shipping:"Livraison",total:"Total",free:"Gratuit",place_order_button:"Passer la commande",processing:"Traitement...",enter_address_for_shipping:"Veuillez entrer votre code postal et ville pour voir les m√©thodes de livraison.",no_payment_methods:"Aucune m√©thode de paiement disponible.",loading_payment_methods:"Chargement des m√©thodes de paiement...",select_payment_method:"S√©lectionner la m√©thode de paiement",order_success_title:"Commande cr√©√©e avec succ√®s!",order_number:"Num√©ro de commande",reference:"R√©f√©rence",payment_method:"M√©thode de paiement",status:"Statut",required_field:"Ce champ est requis",invalid_email:"Veuillez entrer une adresse e-mail valide",invalid_amount:"Le montant doit √™tre sup√©rieur √† z√©ro",bacs_description:"Effectuez votre paiement directement sur notre compte bancaire.",bacs_reference:"Veuillez utiliser votre num√©ro de commande comme r√©f√©rence de paiement.",bacs_cleared:"Votre commande ne sera pas exp√©di√©e tant que les fonds n'auront pas √©t√© cr√©dit√©s sur notre compte.",check_send_to:"Veuillez envoyer un ch√®que √†",cod_description:"Payez en esp√®ces √† la livraison.",card_number:"Num√©ro de carte",expiry_date:"Date d'expiration",card_code:"Code de carte",cvc:"CVC",select_pickup_location:"S√©lectionnez votre point de retrait",choose_shipping_provider:"Choisissez le transporteur",choose_delivery_speed:"Choisissez la vitesse de livraison",express_delivery:"Livraison Express",normal_delivery:"Livraison Standard",select_pickup_point:"S√©lectionnez le point de retrait",choose_nearest_pickup:"Choisissez votre point de retrait le plus proche...",no_locations_available:"Aucun point de retrait disponible dans votre pays pour ce transporteur.",try_different_provider:"Essayez de s√©lectionner un autre transporteur ou v√©rifiez si votre pays est pris en charge.",loading_locations:"Chargement des emplacements...",shipping_manager:"Gestionnaire de livraison",manage_shipping:"G√©rez vos emplacements de livraison et tarifs",add_location:"Ajouter un emplacement",save_changes:"Sauvegarder les modifications",location_name:"Nom de l'emplacement",express_price:"Prix Express",normal_price:"Prix Standard",delete_location:"Supprimer l'emplacement",confirm_delete:"√ätes-vous s√ªr de vouloir supprimer cet emplacement?",active_sessions:"Sessions de livraison actives",session_id:"ID de session",customer:"Client",expires:"Expire",actions:"Actions",view_details:"Voir les d√©tails",no_sessions:"Aucune session active",languages:"Langues",installed:"Install√©",not_installed:"Non install√©",download:"T√©l√©charger",download_all:"Tout t√©l√©charger",first_order_benefits:"Avantages de la premi√®re commande",free_shipping_after_first:"Apr√®s votre premi√®re commande, profitez de",free_shipping_badge:"LIVRAISON GRATUITE",free_shipping_duration:"sur les commandes suppl√©mentaires pendant les 5 prochaines heures!",free_shipping_active:"Livraison gratuite active!",order_in_session:"Commande",in_this_session:"dans cette session",saved:"√âconomis√©",end_session:"Terminer la session",confirm_end_session:"√ätes-vous s√ªr de vouloir terminer votre session de livraison gratuite?"},es:{reference_label:"Referencia del pedido",reference_placeholder:"Ingrese la referencia",amount_label:"Cantidad",amount_placeholder:"0.00",email_label:"Correo electr√≥nico",email_placeholder:"tu@email.com",first_name_label:"Nombre",first_name_placeholder:"Juan",last_name_label:"Apellido",last_name_placeholder:"Garc√≠a",address_label:"Direcci√≥n",address_placeholder:"Direcci√≥n de calle",city_label:"Ciudad",city_placeholder:"Nombre de ciudad",postcode_label:"C√≥digo postal",postcode_placeholder:"28001",country_label:"Pa√≠s",phone_label:"Tel√©fono",phone_placeholder:"+34 912 34 56 78",order_details:"Detalles del pedido",customer_information:"Informaci√≥n del cliente",shipping_method_label:"M√©todo de env√≠o",payment_method_label:"M√©todo de pago",order_summary:"Resumen del pedido",subtotal:"Subtotal",shipping:"Env√≠o",total:"Total",free:"Gratis",place_order_button:"Realizar pedido",processing:"Procesando...",enter_address_for_shipping:"Por favor ingrese su c√≥digo postal y ciudad para ver los m√©todos de env√≠o.",no_payment_methods:"No hay m√©todos de pago disponibles.",loading_payment_methods:"Cargando m√©todos de pago...",select_payment_method:"Seleccionar m√©todo de pago",order_success_title:"¬°Pedido creado exitosamente!",order_number:"N√∫mero de pedido",reference:"Referencia",payment_method:"M√©todo de pago",status:"Estado",required_field:"Este campo es obligatorio",invalid_email:"Por favor ingrese una direcci√≥n de correo v√°lida",invalid_amount:"La cantidad debe ser mayor que cero",bacs_description:"Realice su pago directamente en nuestra cuenta bancaria.",bacs_reference:"Por favor use su ID de pedido como referencia de pago.",bacs_cleared:"Su pedido no ser√° enviado hasta que los fondos se hayan acreditado en nuestra cuenta.",check_send_to:"Por favor env√≠e un cheque a",cod_description:"Pague en efectivo contra entrega.",card_number:"N√∫mero de tarjeta",expiry_date:"Fecha de vencimiento",card_code:"C√≥digo de tarjeta",cvc:"CVC",select_pickup_location:"Seleccione su punto de recogida",choose_shipping_provider:"Elija el proveedor de env√≠o",choose_delivery_speed:"Elija la velocidad de entrega",express_delivery:"Entrega Express",normal_delivery:"Entrega Est√°ndar",select_pickup_point:"Seleccione el punto de recogida",choose_nearest_pickup:"Elija su punto de recogida m√°s cercano...",no_locations_available:"No hay puntos de recogida disponibles en su pa√≠s para este proveedor.",try_different_provider:"Intente seleccionar otro proveedor o verifique si su pa√≠s es compatible.",loading_locations:"Cargando ubicaciones...",shipping_manager:"Gestor de env√≠os",manage_shipping:"Gestione sus ubicaciones de env√≠o y precios",add_location:"Agregar ubicaci√≥n",save_changes:"Guardar cambios",location_name:"Nombre de ubicaci√≥n",express_price:"Precio Express",normal_price:"Precio Est√°ndar",delete_location:"Eliminar ubicaci√≥n",confirm_delete:"¬øEst√° seguro de que desea eliminar esta ubicaci√≥n?",active_sessions:"Sesiones de env√≠o activas",session_id:"ID de sesi√≥n",customer:"Cliente",expires:"Caduca",actions:"Acciones",view_details:"Ver detalles",no_sessions:"No hay sesiones activas",languages:"Idiomas",installed:"Instalado",not_installed:"No instalado",download:"Descargar",download_all:"Descargar todos",first_order_benefits:"Beneficios del primer pedido",free_shipping_after_first:"Despu√©s de su primer pedido, disfrute de",free_shipping_badge:"ENV√çO GRATIS",free_shipping_duration:"en pedidos adicionales durante las pr√≥ximas 5 horas!",free_shipping_active:"¬°Env√≠o gratis activo!",order_in_session:"Pedido",in_this_session:"en esta sesi√≥n",saved:"Ahorrado",end_session:"Terminar sesi√≥n",confirm_end_session:"¬øEst√° seguro de que desea finalizar su sesi√≥n de env√≠o gratis?"},de:{reference_label:"Bestellreferenz",reference_placeholder:"Referenz eingeben",amount_label:"Betrag",amount_placeholder:"0.00",email_label:"E-Mail",email_placeholder:"ihre@email.de",first_name_label:"Vorname",first_name_placeholder:"Hans",last_name_label:"Nachname",last_name_placeholder:"Schmidt",address_label:"Adresse",address_placeholder:"Stra√üenadresse",city_label:"Stadt",city_placeholder:"Stadtname",postcode_label:"Postleitzahl",postcode_placeholder:"10115",country_label:"Land",phone_label:"Telefon",phone_placeholder:"+49 30 12345678",order_details:"Bestelldetails",customer_information:"Kundeninformationen",shipping_method_label:"Versandart",payment_method_label:"Zahlungsmethode",order_summary:"Bestell√ºbersicht",subtotal:"Zwischensumme",shipping:"Versand",total:"Gesamt",free:"Kostenlos",place_order_button:"Bestellung aufgeben",processing:"Verarbeitung...",enter_address_for_shipping:"Bitte geben Sie Ihre Postleitzahl und Stadt ein, um Versandmethoden zu sehen.",no_payment_methods:"Keine Zahlungsmethoden verf√ºgbar.",loading_payment_methods:"Zahlungsmethoden werden geladen...",select_payment_method:"Zahlungsmethode w√§hlen",order_success_title:"Bestellung erfolgreich erstellt!",order_number:"Bestellnummer",reference:"Referenz",payment_method:"Zahlungsmethode",status:"Status",required_field:"Dieses Feld ist erforderlich",invalid_email:"Bitte geben Sie eine g√ºltige E-Mail-Adresse ein",invalid_amount:"Der Betrag muss gr√∂√üer als Null sein",bacs_description:"Zahlen Sie direkt auf unser Bankkonto.",bacs_reference:"Bitte verwenden Sie Ihre Bestellnummer als Zahlungsreferenz.",bacs_cleared:"Ihre Bestellung wird erst versendet, wenn das Geld auf unserem Konto eingegangen ist.",check_send_to:"Bitte senden Sie einen Scheck an",cod_description:"Zahlung bei Lieferung in bar.",card_number:"Kartennummer",expiry_date:"Ablaufdatum",card_code:"Kartencode",cvc:"CVC",select_pickup_location:"W√§hlen Sie Ihren Abholort",choose_shipping_provider:"Versanddienstleister w√§hlen",choose_delivery_speed:"Liefergeschwindigkeit w√§hlen",express_delivery:"Express-Lieferung",normal_delivery:"Standard-Lieferung",select_pickup_point:"Abholpunkt w√§hlen",choose_nearest_pickup:"W√§hlen Sie Ihren n√§chsten Abholpunkt...",no_locations_available:"Keine Abholorte in Ihrem Land f√ºr diesen Anbieter verf√ºgbar.",try_different_provider:"Versuchen Sie einen anderen Anbieter oder pr√ºfen Sie, ob Ihr Land unterst√ºtzt wird.",loading_locations:"Standorte werden geladen...",shipping_manager:"Versandverwaltung",manage_shipping:"Verwalten Sie Ihre Versandstandorte und Preise",add_location:"Standort hinzuf√ºgen",save_changes:"√Ñnderungen speichern",location_name:"Standortname",express_price:"Express-Preis",normal_price:"Standard-Preis",delete_location:"Standort l√∂schen",confirm_delete:"Sind Sie sicher, dass Sie diesen Standort l√∂schen m√∂chten?",active_sessions:"Aktive Versandsessions",session_id:"Session-ID",customer:"Kunde",expires:"L√§uft ab",actions:"Aktionen",view_details:"Details anzeigen",no_sessions:"Keine aktiven Sessions",languages:"Sprachen",installed:"Installiert",not_installed:"Nicht installiert",download:"Herunterladen",download_all:"Alle herunterladen",first_order_benefits:"Vorteile der ersten Bestellung",free_shipping_after_first:"Nach Ihrer ersten Bestellung genie√üen Sie",free_shipping_badge:"KOSTENLOSER VERSAND",free_shipping_duration:"bei zus√§tzlichen Bestellungen f√ºr die n√§chsten 5 Stunden!",free_shipping_active:"Kostenloser Versand aktiv!",order_in_session:"Bestellung",in_this_session:"in dieser Session",saved:"Gespart",end_session:"Session beenden",confirm_end_session:"Sind Sie sicher, dass Sie Ihre kostenlose Versandsession beenden m√∂chten?"}},R={en:"English",fr:"Fran√ßais",es:"Espa√±ol",de:"Deutsch"},F=()=>{const e=(navigator.language||navigator.userLanguage).split("-")[0];return D[e]?e:"en"},G=(V=(e,t)=>{var n;return{config:null,language:"undefined"!=typeof localStorage&&localStorage.getItem("directpay_language")||F(),formData:{reference:"",amount:"",email:"",firstName:"",lastName:"",address:"",city:"",postcode:"",country:(null==(n=window.directPayConfig)?void 0:n.defaultCountry)||"FR",phone:""},shippingMethods:[],selectedShippingMethod:null,shippingLoading:!1,selectedPickupPoint:null,paymentMethods:[],selectedPaymentMethod:null,paymentLoading:!1,isLoading:!1,isProcessing:!1,errors:{},globalError:null,orderSuccess:!1,orderData:null,initializeConfig:t=>e({config:t}),updateFormData:(t,n)=>e(e=>({formData:{...e.formData,[t]:n},errors:{...e.errors,[t]:null},globalError:null})),batchUpdateFormData:t=>e(e=>({formData:{...e.formData,...t}})),setErrors:t=>e({errors:t,globalError:null}),setGlobalError:t=>e({globalError:t}),clearError:t=>e(e=>({errors:{...e.errors,[t]:null}})),setLoading:t=>e({isLoading:t}),setProcessing:t=>e({isProcessing:t}),setShippingMethods:t=>e({shippingMethods:t,shippingLoading:!1}),setShippingLoading:t=>e({shippingLoading:t}),selectShippingMethod:t=>e({selectedShippingMethod:t}),setPaymentMethods:t=>e({paymentMethods:t,paymentLoading:!1}),setPaymentLoading:t=>e({paymentLoading:t}),selectPaymentMethod:t=>e({selectedPaymentMethod:t}),setPickupPoint:t=>e({selectedPickupPoint:t}),clearPickupPoint:()=>e({selectedPickupPoint:null}),setOrderSuccess:(t,n=null)=>e({orderSuccess:t,orderData:n}),resetForm:()=>{var t;return e({formData:{reference:"",amount:"",email:"",firstName:"",lastName:"",address:"",city:"",postcode:"",country:(null==(t=window.directPayConfig)?void 0:t.defaultCountry)||"FR",phone:""},errors:{},globalError:null,selectedShippingMethod:null,selectedPaymentMethod:null,selectedPickupPoint:null,orderSuccess:!1,orderData:null})},validateField:(e,n)=>{const o=t().config,r=(null==o?void 0:o.translations)||{};if(!n||""===n.trim())return r.error_required||"This field is required";if("email"===e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return r.error_email||"Invalid email address";if("amount"===e){const e=parseFloat(n);if(isNaN(e)||e<=0)return r.error_amount||"Amount must be greater than 0"}return null},validateForm:()=>{const{formData:n,validateField:o}=t(),r={};return["reference","amount","email","firstName","lastName"].forEach(e=>{const t=o(e,n[e]);t&&(r[e]=t)}),e({errors:r}),0===Object.keys(r).length},setLanguage:t=>{"undefined"!=typeof localStorage&&localStorage.setItem("directpay_language",t),e({language:t})},t:e=>{const{language:n}=t();return((e,t="en")=>{var n;return(null==(n=D[t])?void 0:n[e])||D.en[e]||e})(e,n)}}})?A(V):A;var V;const z=()=>window.directPayConfig||{},B=async(e,t={})=>{const n={headers:{"Content-Type":"application/json","X-WP-Nonce":z().nonce},...t},o=await fetch(e,n);if(!o.ok){const e=await o.json();throw new Error(e.message||"API request failed")}return o.json()},q=async e=>{const t=z(),n={reference:e.formData.reference,amount:parseFloat(e.formData.amount),customer:{email:e.formData.email,first_name:e.formData.firstName,last_name:e.formData.lastName,address_1:e.formData.address,city:e.formData.city,postcode:e.formData.postcode,country:e.formData.country,phone:e.formData.phone},shipping_method:e.shippingMethod,payment_method:e.paymentMethod,locale:t.locale};e.paymentIntentId&&(n.payment_intent_id=e.paymentIntentId),e.pickupPoint&&(n.pickup_point=e.pickupPoint),void 0!==e.shippingCost&&(n.shipping_cost=parseFloat(e.shippingCost)),e.hasActiveSession&&(n.has_active_session=!0,n.session_id=e.sessionId),e.savePaymentMethod&&(n.save_payment_method=!0);return await B(`${t.apiUrl}/orders`,{method:"POST",body:JSON.stringify(n)})},$=(e,t=null)=>{const n=t||{},{currencySymbol:o="‚Ç¨",currencyPosition:r="left",currencyDecimals:a=2,currencyDecimalSeparator:s=".",currencyThousandSeparator:i=","}=n,l="string"==typeof e?parseFloat(e):e;if(isNaN(l))return`${o}0${s}00`;const c=l.toFixed(a).split("."),d=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,i),p=c[1],u=p?`${d}${s}${p}`:d;switch(r){case"left":default:return`${o}${u}`;case"right":return`${u}${o}`;case"left_space":return`${o} ${u}`;case"right_space":return`${u} ${o}`}},U=()=>o.jsxs("div",{className:"directpay-loading",children:[o.jsx("div",{className:"directpay-loading__spinner"}),o.jsx("p",{className:"directpay-loading__text",children:"Processing..."})]});var H,W="https://js.stripe.com",Z="".concat(W,"/").concat("clover","/stripe.js"),J=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,K=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Y=function(e){return J.test(e)||K.test(e)},Q=function(e){var t=document.createElement("script");t.src="".concat(Z).concat("");var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(t),t},X=null,ee=null,te=null,ne=function(e){return null!==X?X:(X=new Promise(function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)t(window.Stripe);else try{var o=function(){for(var e=document.querySelectorAll('script[src^="'.concat(W,'"]')),t=0;t<e.length;t++){var n=e[t];if(Y(n.src))return n}return null}();if(o&&e);else if(o){if(o&&null!==te&&null!==ee){var r;o.removeEventListener("load",te),o.removeEventListener("error",ee),null===(r=o.parentNode)||void 0===r||r.removeChild(o),o=Q()}}else o=Q();te=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),ee=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),o.addEventListener("load",te),o.addEventListener("error",ee)}catch(a){return void n(a)}else t(null)})).catch(function(e){return X=null,Promise.reject(e)})};Promise.resolve().then(function(){return H||(H=ne(null).catch(function(e){return H=null,Promise.reject(e)}))}).catch(function(e){console.warn(e)});var oe={exports:{}};function re(){}function ae(){}ae.resetWarningCache=re;oe.exports=function(){function e(e,t,n,o,r,a){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==a){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:ae,resetWarningCache:re};return n.PropTypes=n,n}();const se=t(oe.exports);function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach(function(t){de(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var o,r,a=[],s=!0,i=!1;try{for(n=n.call(e);!(s=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);s=!0);}catch(l){i=!0,r=l}finally{try{s||null==n.return||n.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var he=function(e,t,o){var r=!!o,a=n.useRef(o);n.useEffect(function(){a.current=o},[o]),n.useEffect(function(){if(!r||!e)return function(){};var n=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,n),function(){e.off(t,n)}},[r,t,e,a])},ye=function(e){return null!==e&&"object"===ce(e)},ge="[object Object]",_e=function e(t,n){if(!ye(t)||!ye(n))return t===n;var o=Array.isArray(t);if(o!==Array.isArray(n))return!1;var r=Object.prototype.toString.call(t)===ge;if(r!==(Object.prototype.toString.call(n)===ge))return!1;if(!r&&!o)return t===n;var a=Object.keys(t),s=Object.keys(n);if(a.length!==s.length)return!1;for(var i={},l=0;l<a.length;l+=1)i[a[l]]=!0;for(var c=0;c<s.length;c+=1)i[s[c]]=!0;var d=Object.keys(i);if(d.length!==a.length)return!1;var p=t,u=n;return d.every(function(t){return e(p[t],u[t])})},fe=function(e,t,n){return ye(e)?Object.keys(e).reduce(function(o,r){var a=!ye(t)||!_e(e[r],t[r]);return n.includes(r)?(a&&console.warn("Unsupported prop change: options.".concat(r," is not a mutable property.")),o):a?le(le({},o||{}),{},de({},r,e[r])):o},null):null},ve=n.createContext(null);ve.displayName="ElementsContext";se.any,se.object,se.func.isRequired;var xe=n.createContext(null);xe.displayName="CheckoutContext",se.any,se.shape({clientSecret:se.oneOfType([se.string,se.instanceOf(Promise)]).isRequired,elementsOptions:se.object}).isRequired;var be=function(e){var t=n.useContext(xe),o=n.useContext(ve);if(t){if(o)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t}return function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e}(o,e)},we=["mode"],je=function(e,t){var o,r="".concat((o=e).charAt(0).toUpperCase()+o.slice(1),"Element"),a=t?function(e){be("mounts <".concat(r,">"));var t=e.id,o=e.className;return n.createElement("div",{id:t,className:o})}:function(t){var o,a=t.id,s=t.className,i=t.options,l=void 0===i?{}:i,c=t.onBlur,d=t.onFocus,p=t.onReady,u=t.onChange,m=t.onEscape,h=t.onClick,y=t.onLoadError,g=t.onLoaderStart,_=t.onNetworksChange,f=t.onConfirm,v=t.onCancel,x=t.onShippingAddressChange,b=t.onShippingRateChange,w=t.onSavedPaymentMethodRemove,j=t.onSavedPaymentMethodUpdate,k=be("mounts <".concat(r,">")),C="elements"in k?k.elements:null,N="checkoutState"in k?k.checkoutState:null,S="success"===(null==N?void 0:N.type)||"loading"===(null==N?void 0:N.type)?N.sdk:null,P=ue(n.useState(null),2),E=P[0],L=P[1],M=n.useRef(null),T=n.useRef(null);he(E,"blur",c),he(E,"focus",d),he(E,"escape",m),he(E,"click",h),he(E,"loaderror",y),he(E,"loaderstart",g),he(E,"networkschange",_),he(E,"confirm",f),he(E,"cancel",v),he(E,"shippingaddresschange",x),he(E,"shippingratechange",b),he(E,"savedpaymentmethodremove",w),he(E,"savedpaymentmethodupdate",j),he(E,"change",u),p&&(o="expressCheckout"===e?p:function(){p(E)}),he(E,"ready",o),n.useLayoutEffect(function(){if(null===M.current&&null!==T.current&&(C||S)){var t=null;if(S)switch(e){case"paymentForm":t=S.createPaymentFormElement(l);break;case"payment":t=S.createPaymentElement(l);break;case"address":if(!("mode"in l))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var n=l.mode,o=pe(l,we);if("shipping"===n)t=S.createShippingAddressElement(o);else{if("billing"!==n)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");t=S.createBillingAddressElement(o)}break;case"expressCheckout":t=S.createExpressCheckoutElement(l);break;case"currencySelector":t=S.createCurrencySelectorElement();break;case"taxId":t=S.createTaxIdElement(l);break;default:throw new Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else C&&(t=C.create(e,l));M.current=t,L(t),t&&t.mount(T.current)}},[C,S,l]);var I,O,A=(I=l,O=n.useRef(I),n.useEffect(function(){O.current=I},[I]),O.current);return n.useEffect(function(){if(M.current){var e=fe(l,A,["paymentRequest"]);e&&"update"in M.current&&M.current.update(e)}},[l,A]),n.useLayoutEffect(function(){return function(){if(M.current&&"function"==typeof M.current.destroy)try{M.current.destroy(),M.current=null}catch(e){}}},[]),n.createElement("div",{id:a,className:s,ref:T})};return a.propTypes={id:se.string,className:se.string,onChange:se.func,onBlur:se.func,onFocus:se.func,onReady:se.func,onEscape:se.func,onClick:se.func,onLoadError:se.func,onLoaderStart:se.func,onNetworksChange:se.func,onConfirm:se.func,onCancel:se.func,onShippingAddressChange:se.func,onShippingRateChange:se.func,onSavedPaymentMethodRemove:se.func,onSavedPaymentMethodUpdate:se.func,options:se.object},a.displayName=r,a.__elementType=e,a},ke="undefined"==typeof window;n.createContext(null).displayName="EmbeddedCheckoutProviderContext",je("auBankAccount",ke),je("card",ke),je("cardNumber",ke),je("cardExpiry",ke),je("cardCvc",ke),je("iban",ke),je("payment",ke),je("expressCheckout",ke),je("paymentRequestButton",ke),je("linkAuthentication",ke),je("address",ke),je("shippingAddress",ke),je("paymentMethodMessaging",ke),je("taxId",ke);const Ce=({paymentMethod:t,amount:n=0,fallback:r})=>{const[a,s]=e.useState(null),[i,l]=e.useState(!0),[c,d]=e.useState(!0);return e.useEffect(()=>{(async()=>{var e,n,o,r;try{console.log("[NativePaymentGateway] Loading native fields for:",t);const a=z();console.log("[NativePaymentGateway] API URL:",a.apiUrl);const i=await fetch(`${a.apiUrl}/payment-fields`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_method:t})});if(console.log("[NativePaymentGateway] Response status:",i.status),!i.ok){const e=await i.text();throw console.error("[NativePaymentGateway] Response error:",e),new Error("Failed to load native fields")}const c=await i.json();if(console.log("[NativePaymentGateway] Response data:",c),console.log("[NativePaymentGateway] HTML length:",null==(e=c.html)?void 0:e.length),console.log("[NativePaymentGateway] Scripts count:",null==(n=c.scripts)?void 0:n.length),c.scripts&&c.scripts.length>0){console.log("[NativePaymentGateway] Loading scripts...");for(const e of c.scripts)console.log("[NativePaymentGateway] Loading script:",e.handle,e.src),"wc-stripe"!==e.handle&&"wc-stripe-upe"!==e.handle||!e.params||(console.log("[NativePaymentGateway] Injecting Stripe params for:",e.handle,e.params),"wc-stripe-upe"===e.handle?(window.wc_stripe_upe_params={key:e.params.key,testMode:e.params.testmode,isCheckout:!0,isChangingPayment:!1,isSetupIntent:!1,isOrderPay:!1,isPayForOrder:!1,currency:"usd",country:"US",locale:"en",nonce:{checkout:(null==(o=window.directPayConfig)?void 0:o.nonce)||""},ajax_url:window.location.origin+"/wp-admin/admin-ajax.php",wcBlocksUPEAppearance:{},cartContainsSubscription:!1,showSavedCards:!1,showSaveOption:!1,showTerms:!1,terms:"",upeParams:{}},console.log("[NativePaymentGateway] Full wc_stripe_upe_params:",window.wc_stripe_upe_params)):(window.wc_stripe_params={key:e.params.key,testmode:e.params.testmode?"1":"0",inline_cc_form:"yes",is_checkout:"yes",return_url:window.location.origin+"/checkout/order-received/",ajaxurl:window.location.origin+"/wp-admin/admin-ajax.php",stripe_locale:"en",nonce:(null==(r=window.directPayConfig)?void 0:r.nonce)||"",statement_descriptor:"",elements_options:{},elements_styling:!1,elements_classes:!1,sepa_elements_options:{},is_change_payment_page:!1,is_add_payment_page:!1,is_pay_for_order_page:!1,elements_location:"checkout",is_product_page:!1,is_cart_page:!1},console.log("[NativePaymentGateway] Full wc_stripe_params:",window.wc_stripe_params))),await Ne(e.src,e.handle);console.log("[NativePaymentGateway] All scripts loaded")}s(c.html),l(!0),console.log("[NativePaymentGateway] Native rendering enabled")}catch(a){console.warn("[NativePaymentGateway] Native payment fields not available, using fallback:",a),l(!1)}finally{d(!1)}})()},[t]),e.useEffect(()=>{a&&i&&(console.log("[NativePaymentGateway] Initializing payment gateway, HTML injected"),requestAnimationFrame(()=>{setTimeout(async()=>{console.log("[NativePaymentGateway] Triggering WooCommerce events after RAF");const e=document.querySelector("#stripe-card-element");if(console.log("[NativePaymentGateway] #stripe-card-element found:",!!e),e)console.log("[NativePaymentGateway] #stripe-card-element has children:",e.children.length),console.log("[NativePaymentGateway] #stripe-card-element innerHTML:",e.innerHTML);else{const e=document.querySelectorAll('[id*="stripe"]');console.log('[NativePaymentGateway] Found elements with "stripe" in ID:',e.length),e.forEach(e=>console.log("[NativePaymentGateway] - Found:",e.id,e.tagName))}if(window.wc_stripe_upe_params&&window.Stripe&&window.wc_stripe_upe_params.key){if(console.log("[NativePaymentGateway] Attempting manual UPE initialization..."),console.log("[NativePaymentGateway] Stripe already loaded:",!!window.Stripe),window.directPayStripe&&window.directPayElements)return void console.log("[NativePaymentGateway] ‚ö†Ô∏è Stripe already initialized, skipping re-initialization");try{const e=window.Stripe(window.wc_stripe_upe_params.key);console.log("[NativePaymentGateway] Stripe instance created");z();const t=n||0;console.log("[NativePaymentGateway] Initial amount:",t),console.log("[NativePaymentGateway] Creating Elements with mode: payment (allows amount updates)");const o=Math.round(100*t),r=e.elements({mode:"payment",amount:o,currency:"bdt",appearance:{theme:"stripe"},locale:window.wc_stripe_upe_params.locale||"auto"});console.log("[NativePaymentGateway] Elements created with amount:",o,"cents");let a=document.querySelector("#wc-stripe-upe-element");if(!a){const e=document.querySelector("#wc-stripe-upe-form");e?(console.log("[NativePaymentGateway] Creating UPE element container..."),a=document.createElement("div"),a.id="wc-stripe-upe-element",e.insertBefore(a,e.firstChild)):console.log("[NativePaymentGateway] UPE form not found")}if(a){console.log("[NativePaymentGateway] Found/created UPE container, mounting Payment Element...");const t=r.create("payment",{layout:"tabs"});t.mount("#wc-stripe-upe-element"),console.log("[NativePaymentGateway] Payment Element mounted!"),t.on("change",e=>{var t;console.log("[NativePaymentGateway] Payment method changed:",e);const n=document.getElementById("place-order-button");if(n&&(null==(t=e.value)?void 0:t.type)){const t=e.value.type;console.log("[NativePaymentGateway] Payment type:",t),window.directPaySelectedPaymentType=t,n.textContent="google_pay"===t?"Pay with Google Pay":"apple_pay"===t?"Pay with Apple Pay":"link"===t?"Pay with Link":"Place Order"}}),window.directPayStripe=e,window.directPayElements=r,window.directPayPaymentElement=t,console.log("[NativePaymentGateway] Stripe instances stored globally")}else console.log("[NativePaymentGateway] Could not find or create UPE container")}catch(t){console.error("[NativePaymentGateway] Error initializing Stripe:",t)}}window.jQuery?(console.log("[NativePaymentGateway] jQuery available"),console.log("[NativePaymentGateway] window.Stripe available:",void 0!==window.Stripe),console.log("[NativePaymentGateway] window.wc_stripe_params:",window.wc_stripe_params),console.log("[NativePaymentGateway] window.wc_stripe_upe_params:",window.wc_stripe_upe_params),console.log("[NativePaymentGateway] Triggering updated_checkout..."),window.jQuery(document.body).trigger("updated_checkout"),console.log("[NativePaymentGateway] Triggering payment_method_selected..."),window.jQuery(document.body).trigger("payment_method_selected"),console.log("[NativePaymentGateway] Events triggered")):console.warn("[NativePaymentGateway] jQuery not available")},100)}))},[a,i]),c?o.jsxs("div",{className:"payment-gateway-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading payment gateway..."})]}):i&&a?(console.log("[NativePaymentGateway] Rendering native HTML"),o.jsx("div",{className:"native-payment-gateway woocommerce-checkout-payment",id:"payment",dangerouslySetInnerHTML:{__html:a}})):(console.log("[NativePaymentGateway] Using fallback rendering"),r)},Ne=(e,t)=>new Promise((n,o)=>{if(document.getElementById(t))return void n();const r=document.createElement("script");r.id=t,r.src=e,r.onload=n,r.onerror=o,document.head.appendChild(r)}),Se=({amount:t})=>{const[n,r]=e.useState([]),[a,s]=e.useState(null),[i,l]=e.useState(!0),{selectPaymentMethod:c,t:d}=G();return e.useEffect(()=>{(async()=>{console.log("[PaymentMethods] Loading payment methods..."),l(!0);const e=await(async()=>{const e=z();try{return(await B(`${e.apiUrl}/payment-methods`,{method:"GET"})).payment_methods||[]}catch(t){return console.error("Error fetching payment methods:",t),[]}})();console.log("[PaymentMethods] Loaded methods:",e),r(e),e.length>0&&(console.log("[PaymentMethods] Auto-selecting first method:",e[0].id),s(e[0].id),c(e[0].id)),l(!1)})()},[c]),i?o.jsxs("div",{className:"directpay-payment-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:d("loading_payment_methods")})]}):0===n.length?o.jsx("div",{className:"directpay-payment-error",children:d("no_payment_methods")}):o.jsxs("div",{className:"directpay-payment-methods",children:[o.jsx("h3",{children:d("select_payment_method")}),o.jsx("div",{className:"payment-methods-list",children:n.map(e=>o.jsxs("div",{className:"payment-method-option "+(a===e.id?"selected":""),onClick:()=>{console.log("[PaymentMethods] Clicked payment method:",e.id),s(e.id),c(e.id),console.log("[PaymentMethods] Payment method selected:",e.id)},children:[o.jsx("input",{type:"radio",name:"payment_method",value:e.id,checked:a===e.id,onChange:()=>{console.log("[PaymentMethods] Radio changed to:",e.id),s(e.id),c(e.id)}}),o.jsxs("label",{children:[o.jsx("span",{className:"payment-method-title",children:e.title}),e.description&&o.jsx("span",{className:"payment-method-description",children:e.description})]})]},e.id))}),o.jsx("div",{className:"payment-method-content",children:a&&o.jsx(Ce,{paymentMethod:a,amount:t},a)})]})},Pe=()=>{const{formData:t,selectedShippingMethod:n,selectedPickupPoint:r}=G(),[a,s]=e.useState(!1),[i,l]=e.useState(!1),[c,d]=e.useState(!1),p=e.useRef(null),u=e.useRef(null),m=e.useRef(null),h=e.useRef(null),y=e.useRef(!1);e.useEffect(()=>{const e=t.amount&&parseFloat(t.amount)>0,o=t.reference&&""!==t.reference.trim(),a=n&&r;return e&&o&&a&&!y.current?(console.log("[ExpressCheckout] Initializing with amount:",t.amount,"reference:",t.reference,"shipping:",n),y.current=!0,g()):e&&o&&a||(console.log("[ExpressCheckout] Waiting for all required fields. Has amount:",e,"Has reference:",o,"Has shipping:",a),y.current=!1),()=>{h.current&&clearTimeout(h.current),m.current&&m.current.unmount()}},[t.amount,t.reference,n,r]);const g=async()=>{try{const e=z(),o=await fetch(`${e.apiUrl}/express-checkout-params`),a=await o.json();if(!a.success||!a.data)return void console.log("[ExpressCheckout] Not available:",a.message||"No data");const{publishable_key:i,currency:c}=a.data,y=parseFloat(t.amount);if(!y||y<=0)return void console.log("[ExpressCheckout] Invalid amount:",t.amount);const g=Math.round(100*y);console.log("[ExpressCheckout] Amount:",y,"‚Üí",g,"cents");const _=window.Stripe(i),f=_.elements({mode:"payment",amount:g,currency:c.toLowerCase(),appearance:{theme:"stripe",variables:{borderRadius:"4px",spacingUnit:"6px"}}}),v=f.create("expressCheckout",{buttonType:{applePay:"buy",googlePay:"buy"},buttonTheme:{applePay:"black",googlePay:"black"},buttonHeight:48,paymentMethods:{applePay:"auto",googlePay:"auto",link:"auto",amazonPay:"never",paypal:"never"},layout:{overflow:"never"}});p.current&&(console.log("[ExpressCheckout] Mounting element to DOM..."),v.mount(p.current),console.log("[ExpressCheckout] Element mounted, waiting for ready event..."),u.current=f,m.current=v,console.log("[ExpressCheckout] Setting 5-second timeout for ready event..."),h.current=setTimeout(()=>{console.warn("[ExpressCheckout] ‚ö†Ô∏è Ready event did NOT fire after 5 seconds!"),console.warn("[ExpressCheckout] This usually means Stripe is still loading or encountered an error"),d(!0),s(!0)},5e3),v.on("ready",e=>{if(console.log("[ExpressCheckout] ========================================"),console.log("[ExpressCheckout] üîî READY EVENT FIRED!"),console.log("[ExpressCheckout] ========================================"),h.current&&(clearTimeout(h.current),h.current=null,console.log("[ExpressCheckout] Timeout cleared")),console.log("[ExpressCheckout] Full event object:",e),console.log("[ExpressCheckout] availablePaymentMethods:",e.availablePaymentMethods),e.availablePaymentMethods){const t=Object.keys(e.availablePaymentMethods),n=t.filter(t=>!0===e.availablePaymentMethods[t]);console.log("[ExpressCheckout] All methods in object:",t),console.log("[ExpressCheckout] Available methods (true):",n),n.length>0?(console.log("[ExpressCheckout] ‚úÖ PAYMENT METHODS AVAILABLE - Showing buttons!"),l(!0),d(!1),s(!0)):(console.log("[ExpressCheckout] ‚ùå NO PAYMENT METHODS AVAILABLE"),console.log("[ExpressCheckout] Reasons:"),console.log("[ExpressCheckout]   - Link: Not activated in test mode OR currency not supported"),console.log("[ExpressCheckout]   - Apple Pay: Domain not verified (plugin.local)"),console.log("[ExpressCheckout]   - Google Pay: Requires HTTPS (you are on HTTP)"),d(!0),s(!0))}else console.log("[ExpressCheckout] ‚ùå No availablePaymentMethods property in event"),d(!0),s(!0);console.log("[ExpressCheckout] ========================================")}),v.on("loaderror",e=>{console.error("[ExpressCheckout] Load error:",e),h.current&&clearTimeout(h.current),d(!0)}),v.on("click",async e=>{console.log("[ExpressCheckout] ========================================"),console.log("[ExpressCheckout] üîî CLICK EVENT FIRED"),console.log("[ExpressCheckout] Payment type:",e.expressPaymentType),console.log("[ExpressCheckout] Full event:",e),console.log("[ExpressCheckout] Resolving with requirements..."),console.log("[ExpressCheckout] ========================================");try{e.resolve({emailRequired:!0,phoneNumberRequired:!0,shippingAddressRequired:!1}),console.log("[ExpressCheckout] ‚úÖ Click event resolved (shipping pre-selected)")}catch(t){console.error("[ExpressCheckout] ‚ùå Error resolving click event:",t)}}),v.on("confirm",async o=>{var a,s,i,l;console.log("[ExpressCheckout] ========================================"),console.log("[ExpressCheckout] Confirm event triggered"),console.log("[ExpressCheckout] Event:",o),console.log("[ExpressCheckout] Billing Details:",o.billingDetails),console.log("[ExpressCheckout] ========================================");try{const c=o.billingDetails||{},d={method:n,pickupPoint:r};console.log("[ExpressCheckout] Using pre-selected shipping:",d);const p=(n||"").split("_"),u=p[0]||"chronopost",m=p[1]||"normal",h=parseFloat((null==r?void 0:r.price)||0),g=y+h;console.log("[ExpressCheckout] Product amount:",y),console.log("[ExpressCheckout] Shipping cost:",h),console.log("[ExpressCheckout] Total amount:",g);const v=(c.name||"").split(" "),x=v[0]||"",b=v.slice(1).join(" ")||"",w={reference:t.reference,amount:g,customer:{email:c.email||t.email,first_name:x,last_name:b,phone:c.phone||t.phone||"",address_1:t.address||(null==(a=c.address)?void 0:a.line1)||"",city:t.city||(null==(s=c.address)?void 0:s.city)||"",postcode:t.postcode||(null==(i=c.address)?void 0:i.postal_code)||"",country:t.country||(null==(l=c.address)?void 0:l.country)||"FR"},payment_method:"stripe",shipping:{provider:u,delivery_type:m,cost:h,pickup_point:r},locale:e.locale||"en_US"};console.log("[ExpressCheckout] Order data prepared:",w);const{error:j}=await f.submit();if(j)return console.error("[ExpressCheckout] ‚ùå Submit error:",j.message),void o.paymentFailed({reason:"fail"});console.log("[ExpressCheckout] Creating payment intent for:",g);const k=await fetch(`${e.apiUrl}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:g})});if(!k.ok)return console.error("[ExpressCheckout] ‚ùå Failed to create payment intent"),void o.paymentFailed({reason:"fail"});const{clientSecret:C,paymentIntentId:N}=await k.json();console.log("[ExpressCheckout] Payment intent created:",N),w.payment_intent_id=N,console.log("[ExpressCheckout] Creating order...");const S=await fetch(`${e.apiUrl}/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!S.ok){const e=await S.text();return console.error("[ExpressCheckout] ‚ùå Order creation failed:",e),void o.paymentFailed({reason:"fail"})}const P=await S.json();if(console.log("[ExpressCheckout] ‚úÖ Order created:",P),P.success){const{error:e}=await _.confirmPayment({elements:f,clientSecret:C,confirmParams:{return_url:window.location.origin+window.location.pathname+"?order="+P.order_id}});e&&(console.error("[ExpressCheckout] ‚ùå Payment confirmation failed:",e),o.paymentFailed({reason:"fail"}))}else console.error("[ExpressCheckout] ‚ùå Order creation failed:",P.message),o.paymentFailed({reason:"fail"})}catch(c){console.error("[ExpressCheckout] ‚ùå Exception:",c),o.paymentFailed({reason:"fail"})}}),v.on("cancel",e=>{console.log("[ExpressCheckout] ========================================"),console.log("[ExpressCheckout] ‚ùå CANCEL EVENT FIRED"),console.log("[ExpressCheckout] Full event:",e),console.log("[ExpressCheckout] Reason: User cancelled or error occurred"),console.log("[ExpressCheckout] ========================================")}),s(!0))}catch(e){console.error("[ExpressCheckout] Initialization error:",e),d(!0)}};return e.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]),c&&a?(console.log("[ExpressCheckout] Rendering warning message"),o.jsxs("div",{className:"express-checkout-container",style:{padding:"16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",marginBottom:"20px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[o.jsx("span",{style:{fontSize:"18px"},children:"‚ö†Ô∏è"}),o.jsx("strong",{children:"Express Checkout Not Available"})]}),o.jsx("p",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#856404"},children:"Apple Pay, Google Pay, and Link are not currently available. Common reasons:"}),o.jsxs("ul",{style:{margin:"0",paddingLeft:"20px",fontSize:"13px",color:"#856404"},children:[o.jsxs("li",{children:[o.jsx("strong",{children:"Link not activated"})," - Go to Stripe Dashboard ‚Üí Settings ‚Üí Payment methods ‚Üí Enable Link"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Currency issue"})," - Link may not support BDT (Bangladesh Taka). Try USD/EUR"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"HTTP vs HTTPS"})," - Google Pay requires HTTPS (you're on HTTP)"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Domain not verified"})," - Apple Pay requires domain verification"]})]}),o.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:"13px",color:"#856404"},children:[o.jsx("strong",{children:"No problem!"})," You can still complete payment with card below."]})]})):a&&i?o.jsxs("div",{className:"express-checkout-container",children:[o.jsx("div",{ref:p,id:"express-checkout-element",className:"express-checkout-element"}),o.jsx("div",{className:"express-checkout-separator",children:o.jsx("span",{children:"Or pay with card"})})]}):o.jsx("div",{ref:p,id:"express-checkout-element",className:"express-checkout-element",style:{display:"none"}})},Ee=({currentLanguage:e,onLanguageChange:t})=>{const n=Object.entries(R).map(([e,t])=>({value:e,label:t}));return o.jsx("div",{className:"directpay-language-selector",children:o.jsx(a,{options:n,value:e,onChange:t,placeholder:"Select language"})})},Le=({country:t,postcode:n,onShippingChange:r})=>{const[s,i]=e.useState(!1),[l,c]=e.useState(null),[d,p]=e.useState(null),[u,m]=e.useState(null),[h,y]=e.useState([]),[g,_]=e.useState({}),[f,v]=e.useState(!1),{t:x,config:b}=G();e.useEffect(()=>{n&&n.length>=3?i(!0):(i(!1),w())},[n]),e.useEffect(()=>{w()},[t]),e.useEffect(()=>{l&&t&&j()},[l,t]),e.useEffect(()=>{u&&d?null==r||r({provider:l,deliveryType:d,location:u,price:"express"===d?g.express:g.normal}):null==r||r(null)},[u,d]);const w=()=>{c(null),p(null),m(null),y([]),_({})},j=async()=>{var e;v(!0);try{const n=(null==(e=window.directPayConfig)?void 0:e.restUrl)||"/wp-json/",o="mondial_relay"===l?"mondial-relay":l,r=await fetch(`${n}directpay/v1/shipping/checkout-locations?type=${o}&country=${t}`,{method:"GET",credentials:"same-origin"});if(!r.ok)return console.warn("[ShippingSelector] No locations available for",t),y([]),_({}),void v(!1);const a=await r.json();Array.isArray(a)&&a.length>0?(y(a),a[0]&&_({express:a[0].expressPrice,normal:a[0].normalPrice})):(y([]),_({}))}catch(n){console.error("Error loading locations:",n),y([]),_({})}finally{v(!1)}},k=e=>{c(e),p(null),m(null)},C=e=>{p(e),m(null)},N="chronopost"===l?"Chronopost":"Mondial Relay",S="express"===d?g.express:g.normal,P=h.map(e=>({value:e.id,label:e.displayName}));return s?o.jsxs("div",{className:"directpay-shipping-selector",children:[o.jsx("h3",{children:x("select_pickup_location")}),o.jsxs("div",{className:"shipping-provider-selection",children:[o.jsx("h4",{children:x("choose_shipping_provider")}),o.jsxs("div",{className:"shipping-provider-buttons",children:[o.jsxs("button",{type:"button",className:"shipping-provider-btn "+("chronopost"===l?"active":""),onClick:()=>k("chronopost"),children:[o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M12 2L4 7V17L12 22L20 17V7L12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Chronopost"]}),o.jsxs("button",{type:"button",className:"shipping-provider-btn "+("mondial_relay"===l?"active":""),onClick:()=>k("mondial_relay"),children:[o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M12 2L4 7V17L12 22L20 17V7L12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Mondial Relay"]})]})]}),l&&o.jsxs("div",{className:"shipping-delivery-selection",children:[o.jsx("h4",{children:x("choose_delivery_speed")}),f?o.jsxs("div",{className:"shipping-skeleton",children:[o.jsx("div",{className:"shipping-skeleton-item"}),o.jsx("div",{className:"shipping-skeleton-item"})]}):0===h.length?o.jsxs("div",{className:"shipping-no-locations",children:[o.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),o.jsx("p",{children:x("no_locations_available")}),o.jsx("small",{children:x("try_different_provider")})]}):o.jsxs("div",{className:"shipping-delivery-buttons",children:[g.express>0&&o.jsxs("button",{type:"button",className:"shipping-delivery-btn "+("express"===d?"active":""),onClick:()=>C("express"),children:[o.jsxs("span",{className:"shipping-delivery-label",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M16 3H1V16H16V3Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M16 8H20L23 11V16H16V8Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("circle",{cx:"5.5",cy:"18.5",r:"2.5",stroke:"currentColor",strokeWidth:"2"}),o.jsx("circle",{cx:"18.5",cy:"18.5",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]}),x("express_delivery")]}),o.jsx("span",{className:"shipping-delivery-price",children:$(g.express,b)})]}),g.normal>0&&o.jsxs("button",{type:"button",className:"shipping-delivery-btn "+("normal"===d?"active":""),onClick:()=>C("normal"),children:[o.jsxs("span",{className:"shipping-delivery-label",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M21 16V8C20.9996 7.64928 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64928 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M3.27002 6.96L12 12.01L20.73 6.96",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 22.08V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),x("normal_delivery")]}),o.jsx("span",{className:"shipping-delivery-price",children:$(g.normal,b)})]})]})]}),l&&d&&h.length>0&&o.jsx("div",{className:"shipping-location-selection",children:o.jsx(a,{label:`${x("select_pickup_point")} ${N}`,options:P,value:(null==u?void 0:u.id)||"",onChange:e=>{const t=h.find(t=>t.id===e);m(t)},placeholder:x("choose_nearest_pickup")})}),u&&o.jsx("div",{className:"shipping-summary",children:o.jsx("div",{className:"shipping-summary-content",children:o.jsxs("div",{className:"shipping-summary-row",children:[o.jsxs("div",{className:"shipping-summary-left",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M9 11L12 14L22 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),o.jsxs("div",{className:"shipping-summary-info",children:[o.jsxs("span",{className:"shipping-summary-provider",children:[N," ","express"===d?"Express":"Normal"]}),o.jsx("span",{className:"shipping-summary-location",children:u.name}),o.jsxs("span",{className:"shipping-summary-address",children:[u.address,", ",u.postalCode," ",u.city]})]})]}),o.jsx("div",{className:"shipping-summary-price",children:$(S,b)})]})})})]}):null},Me=()=>{const[t,n]=e.useState(null),[r,a]=e.useState(!0),[s,i]=e.useState(0),{t:l,config:c}=G();e.useEffect(()=>{d();const e=setInterval(d,3e4);return()=>clearInterval(e)},[]),e.useEffect(()=>{if(!t)return;i(t.remaining_seconds);const e=setInterval(()=>{i(e=>e<=1?(d(),0):e-1)},1e3);return()=>clearInterval(e)},[t]);const d=async()=>{var e;try{const t=(null==(e=window.directPayConfig)?void 0:e.restUrl)||"/wp-json/",o=await fetch(`${t}directpay/v1/shipping-session/status`,{credentials:"same-origin"}),r=await o.json();r.active?n(r):n(null)}catch(t){console.error("Error checking session:",t),n(null)}finally{a(!1)}};if(r)return null;if(!t)return o.jsxs("div",{className:"directpay-session-status no-session",children:[o.jsx("svg",{className:"session-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{d:"M20 7L12 3L4 7M20 7L12 11M20 7V17L12 21M12 11L4 7M12 11V21M4 7V17L12 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),o.jsxs("div",{className:"session-content",children:[o.jsx("h4",{children:l("first_order_benefits")}),o.jsxs("p",{children:[l("free_shipping_after_first")," ",o.jsx("strong",{children:l("free_shipping_badge")})," ",l("free_shipping_duration")]})]})]});const p=(u=s,{hours:Math.floor(u/3600),minutes:Math.floor(u%3600/60),seconds:u%60});var u;return o.jsxs("div",{className:"directpay-session-status active-session",children:[o.jsxs("svg",{className:"session-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M9 11L12 14L22 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),o.jsxs("div",{className:"session-content",children:[o.jsx("h4",{children:l("free_shipping_active")}),o.jsxs("p",{children:[t.order_count>1&&o.jsxs("span",{className:"order-count",children:[l("order_in_session")," ",t.order_count," ",l("in_this_session")]}),t.total_saved>0&&o.jsxs("span",{className:"savings",children:[l("saved")," ",(null==c?void 0:c.currencySymbol)||"‚Ç¨",t.total_saved.toFixed(2)]})]})]}),o.jsxs("div",{className:"session-timer",children:[o.jsxs("div",{className:"timer-display",children:[p.hours>0&&o.jsxs("div",{className:"time-unit",children:[o.jsx("span",{className:"time-value",children:p.hours}),o.jsx("span",{className:"time-label",children:"h"})]}),o.jsxs("div",{className:"time-unit",children:[o.jsx("span",{className:"time-value",children:p.minutes.toString().padStart(2,"0")}),o.jsx("span",{className:"time-label",children:"m"})]}),o.jsxs("div",{className:"time-unit",children:[o.jsx("span",{className:"time-value",children:p.seconds.toString().padStart(2,"0")}),o.jsx("span",{className:"time-label",children:"s"})]})]}),o.jsx("button",{type:"button",className:"btn-clear-session",onClick:async()=>{var e;if(confirm(l("confirm_end_session")))try{const t=(null==(e=window.directPayConfig)?void 0:e.restUrl)||"/wp-json/";await fetch(`${t}directpay/v1/shipping-session/clear`,{method:"POST",credentials:"same-origin"}),n(null)}catch(t){console.error("Error clearing session:",t)}},title:l("end_session"),children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:o.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]})},Te=()=>{const[t,n]=e.useState(null),[r,s]=e.useState(null),{config:i,language:l,setLanguage:c,t:d,formData:p,errors:u,globalError:m,paymentMethods:h,selectedPaymentMethod:y,paymentLoading:g,isProcessing:_,orderSuccess:f,orderData:v,updateFormData:x,batchUpdateFormData:b,selectPaymentMethod:w,setPaymentMethods:j,setPaymentLoading:k,setProcessing:C,setGlobalError:N,setOrderSuccess:S,validateForm:P,selectShippingMethod:E,setPickupPoint:L}=G();e.useEffect(()=>{const e=localStorage.getItem("directpay_form_data");if(e)try{const t=JSON.parse(e);t.timestamp&&Date.now()-t.timestamp<6048e5?(b(t.data),console.log("[Checkout] Restored form data from localStorage:",t.data)):(localStorage.removeItem("directpay_form_data"),console.log("[Checkout] Removed expired form data"))}catch(t){console.error("[Checkout] Error loading saved data:",t)}},[b]),e.useEffect(()=>{const e={data:{email:p.email,firstName:p.firstName,lastName:p.lastName,address:p.address,city:p.city,postcode:p.postcode,country:p.country,phone:p.phone},timestamp:Date.now()};Object.entries(e.data).some(([e,t])=>t&&""!==t.toString().trim()&&!("country"===e&&"FR"===t))?(localStorage.setItem("directpay_form_data",JSON.stringify(e)),console.log("[Checkout] ‚úÖ Auto-saved shipping info:",e.data)):console.log("[Checkout] ‚è≠Ô∏è Not saving - no meaningful data entered yet")},[p]),e.useEffect(()=>{(async()=>{try{const e=await fetch("/wp-json/directpay/v1/shipping-session/status",{credentials:"same-origin"}),t=await e.json();t.active?(s(t),console.log("[Checkout] Active session found:",t)):s(null)}catch(e){console.error("[Checkout] Error checking session:",e),s(null)}})()},[]);return f&&v?o.jsx("div",{className:"directpay-checkout",children:o.jsxs("div",{className:"directpay-success",children:[o.jsx("div",{className:"directpay-success__icon",children:"‚úì"}),o.jsx("h2",{className:"directpay-success__title",children:"Order Created Successfully!"}),o.jsxs("div",{className:"directpay-success__details",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Order Number:"})," #",v.order_number]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Reference:"})," ",p.reference]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Payment Method:"})," ",v.payment_method_title]}),o.jsxs("div",{className:"directpay-success__summary",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Subtotal:"})," ",v.currency," ",v.subtotal]}),o.jsxs("p",{className:"directpay-success__total",children:[o.jsx("strong",{children:"Total:"})," ",v.currency," ",v.total]})]}),o.jsxs("p",{className:"directpay-success__status",children:["Status: ",o.jsx("span",{className:`status-${v.status}`,children:v.status})]})]})]})}):o.jsx("div",{className:"directpay-checkout",children:o.jsxs("div",{className:"directpay-checkout__body",children:[o.jsx(Me,{}),o.jsx(Ee,{currentLanguage:l,onLanguageChange:c}),_&&o.jsx(U,{}),o.jsx(Pe,{}),o.jsxs("form",{className:"directpay-form",onSubmit:async e=>{e.preventDefault();const n={data:{email:p.email,firstName:p.firstName,lastName:p.lastName,address:p.address,city:p.city,postcode:p.postcode,country:p.country,phone:p.phone},timestamp:Date.now()};if(localStorage.setItem("directpay_form_data",JSON.stringify(n)),console.log("[Checkout] üíæ Saved shipping info before order submission"),!P())return void N("Please fill in all required fields correctly.");if(console.log("[Checkout] Form Validation - Selected Payment Method:",y),console.log("[Checkout] Form Validation - Payment Methods:",h),!y)return console.error("[Checkout] ‚ùå No payment method selected!"),void N("Please select a payment method.");const o=document.querySelector(`input[name="wc-${y}-new-payment-method"]`),a=!!o&&o.checked;console.log("[Checkout] Save payment method:",a),console.log("[Checkout] ‚úÖ Payment method selected:",y),C(!0),N(null);try{if("stripe"===y&&window.directPayStripe&&window.directPayElements){console.log("[Checkout] ========================================"),console.log("[Checkout] Processing Stripe payment..."),console.log("[Checkout] Stripe instance:",window.directPayStripe),console.log("[Checkout] Elements instance:",window.directPayElements),console.log("[Checkout] Payment Element:",window.directPayPaymentElement),console.log("[Checkout] ========================================");const e=parseFloat(p.amount)||0;console.log("[Checkout] Total:",e);const n=window.directPaySelectedPaymentType;console.log("[Checkout] Payment type:",n);const o=["google_pay","apple_pay","link"].includes(n);let l;if(console.log("[Checkout] Is wallet payment:",o),console.log("[Checkout] Submitting payment element..."),o){console.log("[Checkout] Wallet payment - submitting elements (will open wallet modal)");const{error:t}=await window.directPayElements.submit();if(t)throw console.error("[Checkout] ‚ùå Submit error:",t),new Error(t.message);console.log("[Checkout] ‚úÖ Wallet submitted successfully"),console.log("[Checkout] Creating payment intent with total:",e);const n=await fetch(`${i.apiUrl}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!n.ok)throw new Error("Failed to create payment intent");const{clientSecret:o,paymentIntentId:r}=await n.json();console.log("[Checkout] Payment intent created:",r);const{paymentIntent:a,error:s}=await window.directPayStripe.retrievePaymentIntent(o);if(s)throw new Error(s.message);l=a,console.log("[Checkout] Payment Intent Status:",l.status)}else{console.log("[Checkout] Card payment - submitting then confirming");const{error:t}=await window.directPayElements.submit();if(t)throw console.error("[Checkout] ‚ùå Submit error:",t),new Error(t.message);console.log("[Checkout] ‚úÖ Payment element submitted successfully"),console.log("[Checkout] Creating payment intent with total:",e);const n=await fetch(`${i.apiUrl}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!n.ok)throw new Error("Failed to create payment intent");const{clientSecret:o,paymentIntentId:r}=await n.json();console.log("[Checkout] Payment intent created:",r),console.log("[Checkout] Confirming card payment...");const{error:a,paymentIntent:s}=await window.directPayStripe.confirmPayment({elements:window.directPayElements,clientSecret:o,confirmParams:{return_url:window.location.origin+window.location.pathname,payment_method_data:{billing_details:{name:`${p.firstName} ${p.lastName}`,email:p.email,phone:p.phone,address:{line1:p.address,city:p.city,state:p.state||"",postal_code:p.postcode,country:p.country}}}},redirect:"if_required"});if(a)throw console.error("[Checkout] ‚ùå Payment confirmation error:",a),console.error("[Checkout] Error code:",a.code),console.error("[Checkout] Error type:",a.type),new Error(a.message);l=s}if(console.log("[Checkout] Payment confirmed successfully!"),console.log("[Checkout] Payment Intent ID:",l.id),console.log("[Checkout] Payment Intent Status:",l.status),console.log("[Checkout] Payment Intent:",l),o&&l.payment_method){console.log("[Checkout] Extracting addresses from wallet payment...");try{const e=l.payment_method;if(console.log("[Checkout] Payment Method:",e),"object"==typeof e&&e.billing_details){const n=e.billing_details;console.log("[Checkout] Billing Details from wallet:",n);const o={...p,email:n.email||p.email,phone:n.phone||p.phone};if(n.name){const e=n.name.split(" ");o.firstName=e[0]||p.firstName,o.lastName=e.slice(1).join(" ")||p.lastName}n.address&&(o.address=n.address.line1||p.address,o.city=n.address.city||p.city,o.state=n.address.state||p.state,o.postcode=n.address.postal_code||p.postcode,o.country=n.address.country||p.country),console.log("[Checkout] Updated form data with wallet addresses:",o);const s=r?0:(null==t?void 0:t.price)||0,i=await q({formData:o,paymentMethod:y,paymentIntentId:l.id,shippingMethod:(null==t?void 0:t.provider)&&(null==t?void 0:t.deliveryType)?`directpay_shipping_${t.provider}_${t.deliveryType}`:null,pickupPoint:(null==t?void 0:t.location)||null,shippingCost:s,hasActiveSession:!!r,sessionId:(null==r?void 0:r.session_id)||null,savePaymentMethod:a});return void S(!0,i)}}catch(s){console.error("[Checkout] Error extracting wallet addresses:",s)}}const c=r?0:(null==t?void 0:t.price)||0,d=await q({formData:p,paymentMethod:y,paymentIntentId:l.id,shippingMethod:(null==t?void 0:t.provider)&&(null==t?void 0:t.deliveryType)?`directpay_shipping_${t.provider}_${t.deliveryType}`:null,pickupPoint:(null==t?void 0:t.location)||null,shippingCost:c,hasActiveSession:!!r,sessionId:(null==r?void 0:r.session_id)||null,savePaymentMethod:a});S(!0,d)}else{const e=r?0:(null==t?void 0:t.price)||0,n=await q({formData:p,paymentMethod:y,shippingMethod:(null==t?void 0:t.provider)&&(null==t?void 0:t.deliveryType)?`directpay_shipping_${t.provider}_${t.deliveryType}`:null,pickupPoint:(null==t?void 0:t.location)||null,shippingCost:e,hasActiveSession:!!r,sessionId:(null==r?void 0:r.session_id)||null,savePaymentMethod:a});S(!0,n)}}catch(l){console.error("[Checkout] Payment error:",l),N(l.message||"Failed to process payment. Please try again.")}finally{C(!1)}},children:[m&&o.jsx("div",{className:"directpay-alert directpay-alert--error",children:m}),o.jsxs("div",{className:"directpay-form__section",children:[o.jsx("h2",{className:"directpay-form__section-title",children:d("order_details")}),o.jsxs("div",{className:"directpay-form__row",children:[o.jsxs("div",{className:"directpay-form__field",children:[o.jsxs("label",{htmlFor:"reference",className:"directpay-form__label",children:[d("reference_label"),o.jsx("span",{className:"required",children:"*"})]}),o.jsx("input",{type:"text",id:"reference",className:"directpay-form__input "+(u.reference?"error":""),value:p.reference,onChange:e=>x("reference",e.target.value),placeholder:d("reference_placeholder")}),u.reference&&o.jsx("span",{className:"directpay-form__error",children:u.reference})]}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsxs("label",{htmlFor:"amount",className:"directpay-form__label",children:[d("amount_label"),o.jsx("span",{className:"required",children:"*"})]}),o.jsxs("div",{className:"directpay-form__input-group",children:[o.jsx("span",{className:"directpay-form__input-prefix",children:(null==i?void 0:i.currencySymbol)||"‚Ç¨"}),o.jsx("input",{type:"text",inputMode:"decimal",id:"amount",min:"0",className:"directpay-form__input "+(u.amount?"error":""),value:p.amount,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&x("amount",t)},placeholder:d("amount_placeholder")})]}),u.amount&&o.jsx("span",{className:"directpay-form__error",children:u.amount})]})]})]}),o.jsxs("div",{className:"directpay-form__section",children:[o.jsx("h2",{className:"directpay-form__section-title",children:d("customer_information")}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsxs("label",{htmlFor:"email",className:"directpay-form__label",children:[d("email_label"),o.jsx("span",{className:"required",children:"*"})]}),o.jsx("input",{type:"email",id:"email",className:"directpay-form__input "+(u.email?"error":""),value:p.email,onChange:e=>x("email",e.target.value),placeholder:d("email_placeholder")}),u.email&&o.jsx("span",{className:"directpay-form__error",children:u.email})]}),o.jsxs("div",{className:"directpay-form__row",children:[o.jsxs("div",{className:"directpay-form__field",children:[o.jsxs("label",{htmlFor:"firstName",className:"directpay-form__label",children:[d("first_name_label"),o.jsx("span",{className:"required",children:"*"})]}),o.jsx("input",{type:"text",id:"firstName",className:"directpay-form__input "+(u.firstName?"error":""),value:p.firstName,onChange:e=>x("firstName",e.target.value)}),u.firstName&&o.jsx("span",{className:"directpay-form__error",children:u.firstName})]}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsxs("label",{htmlFor:"lastName",className:"directpay-form__label",children:[d("last_name_label"),o.jsx("span",{className:"required",children:"*"})]}),o.jsx("input",{type:"text",id:"lastName",className:"directpay-form__input "+(u.lastName?"error":""),value:p.lastName,onChange:e=>x("lastName",e.target.value)}),u.lastName&&o.jsx("span",{className:"directpay-form__error",children:u.lastName})]})]}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsx("label",{htmlFor:"address",className:"directpay-form__label",children:d("address_label")}),o.jsx("input",{type:"text",id:"address",className:"directpay-form__input",value:p.address,onChange:e=>x("address",e.target.value)})]}),o.jsxs("div",{className:"directpay-form__row",children:[o.jsxs("div",{className:"directpay-form__field",children:[o.jsx("label",{htmlFor:"city",className:"directpay-form__label",children:d("city_label")}),o.jsx("input",{type:"text",id:"city",className:"directpay-form__input",value:p.city,onChange:e=>x("city",e.target.value)})]}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsx("label",{htmlFor:"postcode",className:"directpay-form__label",children:d("postcode_label")}),o.jsx("input",{type:"text",id:"postcode",className:"directpay-form__input",value:p.postcode,onChange:e=>x("postcode",e.target.value)})]})]}),o.jsxs("div",{className:"directpay-form__row",children:[o.jsx("div",{className:"directpay-form__field",children:o.jsx(a,{label:d("country_label"),options:(null==i?void 0:i.countries)?Object.entries(i.countries).map(([e,t])=>({value:e,label:t})):[],value:p.country,onChange:e=>x("country",e),placeholder:"Select country...",searchable:!0})}),o.jsxs("div",{className:"directpay-form__field",children:[o.jsx("label",{htmlFor:"phone",className:"directpay-form__label",children:d("phone_label")}),o.jsx("input",{type:"tel",id:"phone",className:"directpay-form__input",value:p.phone,onChange:e=>x("phone",e.target.value)})]})]})]}),o.jsxs("div",{className:"directpay-form__section",children:[o.jsx("h2",{className:"directpay-form__section-title",children:"Shipping Method"}),o.jsx(Le,{country:p.country,postcode:p.postcode,onShippingChange:e=>{n(e),e?(E(`${e.provider}_${e.deliveryType}`),L({...e.location,price:e.price})):(E(null),L(null))}})]}),o.jsxs("div",{className:"directpay-form__section",children:[o.jsx("h2",{className:"directpay-form__section-title",children:d("payment_method_label")}),!p.amount||parseFloat(p.amount)<=0?o.jsx("div",{className:"directpay-info-message",style:{textAlign:"center",padding:"20px",color:"#666"},children:o.jsx("p",{children:d("Enter Amount First")||"Please enter an amount above to see payment methods."})}):o.jsx(Se,{amount:parseFloat(p.amount)})]}),o.jsxs("div",{className:"directpay-form__section directpay-order-summary",children:[o.jsx("h2",{className:"directpay-form__section-title",children:d("order_summary")}),o.jsxs("div",{className:"directpay-summary",children:[o.jsxs("div",{className:"directpay-summary__row",children:[o.jsxs("span",{className:"directpay-summary__label",children:[d("subtotal"),":"]}),o.jsx("span",{className:"directpay-summary__value",children:$(p.amount||0,i)})]}),t&&o.jsxs("div",{className:"directpay-summary__row",children:[o.jsxs("span",{className:"directpay-summary__label",children:["Shipping (","chronopost"===t.provider?"Chronopost":"Mondial Relay"," - ","express"===t.deliveryType?"Express":"Normal","):"]}),o.jsx("span",{className:"directpay-summary__value",children:r?o.jsx("span",{className:"free-shipping",children:"FREE - Already paid on first order"}):$(t.price,i)})]}),o.jsxs("div",{className:"directpay-summary__row directpay-summary__row--total",children:[o.jsxs("span",{className:"directpay-summary__label",children:[d("total"),":"]}),o.jsx("span",{className:"directpay-summary__value",children:$((parseFloat(p.amount)||0)+(r?0:(null==t?void 0:t.price)||0),i)})]})]})]}),o.jsx("div",{className:"directpay-form__actions",children:o.jsx("button",{type:"submit",className:"directpay-button directpay-button--primary directpay-button--large",disabled:_,id:"place-order-button",children:d(_?"processing":"place_order_button")})})]})]})})};function Ie(){const{initializeConfig:t}=G();return e.useEffect(()=>{window.directPayConfig&&t(window.directPayConfig)},[t]),o.jsx("div",{className:"directpay-checkout-container",children:o.jsx(Te,{})})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("directpay-checkout-root");if(e){r.createRoot(e).render(o.jsx(n.StrictMode,{children:o.jsx(Ie,{})}))}});
