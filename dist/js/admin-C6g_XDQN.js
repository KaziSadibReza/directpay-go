import{r as e,j as s,a as i,R as r}from"./client-C4Hiuctl.js";import{C as n}from"./CustomDropdown-0EZoAZdu.js";const a=()=>{var i,r,a;const[o,l]=e.useState("chronopost"),[t,c]=e.useState("pricing"),[d,p]=e.useState([]),[h,m]=e.useState([]),[u,x]=e.useState({}),[g,j]=e.useState({}),[y,v]=e.useState(!1),[f,N]=e.useState(null),w=(null==(i=window.directpayGoAdmin)?void 0:i.countries)||[],b=(null==(r=window.directpayGoAdmin)?void 0:r.currencySymbol)||"â‚¬",C=()=>{const e="chronopost"===o?u:g,s=Object.keys(e);return 0===s.length?[]:w.filter(e=>s.includes(e.value))},[k,L]=e.useState({name:"",address:"",city:"",postalCode:"",country:"",type:"chronopost"}),[P,E]=e.useState({country:(null==(a=w[0])?void 0:a.value)||"FR",expressPrice:"",normalPrice:""});e.useEffect(()=>{S()},[]);const S=async()=>{v(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations`,{method:"GET",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),s=await e.json();p(s.chronopost||[]),m(s.mondial_relay||[]),x(s.chronopost_pricing||{}),j(s.mondial_relay_pricing||{})}catch(e){console.error("Error loading locations:",e),A("Error loading locations","error")}finally{v(!1)}},A=(e,s="success")=>{N({message:e,type:s}),setTimeout(()=>N(null),3e3)},M=(e,s)=>{L(i=>({...i,[e]:s}))},V="chronopost"===o?d:h,$="chronopost"===o?u:g,G="chronopost"===o?"Chronopost":"Mondial Relay";return s.jsxs("div",{className:"shipping-manager",children:[f&&s.jsx("div",{className:`shipping-notification ${f.type}`,children:f.message}),s.jsxs("div",{className:"shipping-header",children:[s.jsx("h1",{children:"Shipping Management"}),s.jsx("p",{children:"Manage pricing rules and pickup locations for Chronopost and Mondial Relay"})]}),s.jsxs("div",{className:"shipping-tabs",children:[s.jsxs("button",{className:"shipping-tab "+("chronopost"===o?"active":""),onClick:()=>l("chronopost"),children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:s.jsx("path",{d:"M10 2L3 7V13L10 18L17 13V7L10 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Chronopost"]}),s.jsxs("button",{className:"shipping-tab "+("mondial-relay"===o?"active":""),onClick:()=>l("mondial-relay"),children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:s.jsx("path",{d:"M10 2L3 7V13L10 18L17 13V7L10 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Mondial Relay"]})]}),s.jsxs("div",{className:"shipping-section-tabs",children:[s.jsx("button",{className:"section-tab "+("pricing"===t?"active":""),onClick:()=>c("pricing"),children:"Pricing Rules"}),s.jsx("button",{className:"section-tab "+("locations"===t?"active":""),onClick:()=>c("locations"),children:"Pickup Locations"})]}),s.jsx("div",{className:"shipping-content",children:"pricing"===t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Set Pricing Rules for ",G]}),s.jsx("p",{className:"section-description",children:"Define Express and Normal delivery prices per country. These prices will apply to all pickup locations in that country."}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P.expressPrice||P.normalPrice){v(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/pricing`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.directpayGoAdmin.restNonce},body:JSON.stringify({...P,type:o})}),s=await e.json();e.ok?(A("Pricing rule added successfully!","success"),S(),E({country:"FR",expressPrice:"",normalPrice:""})):A(s.message||"Error adding pricing rule","error")}catch(s){console.error("Error adding pricing:",s),A("Error adding pricing rule","error")}finally{v(!1)}}else A("Please set at least one delivery price (Express or Normal)","error")},className:"pricing-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsx("div",{className:"form-field",children:s.jsx(n,{label:"Country *",options:w,value:P.country,onChange:e=>E(s=>({...s,country:e})),searchable:!0,placeholder:"Search countries..."})}),s.jsxs("div",{className:"form-field",children:[s.jsxs("label",{children:["Express Delivery Price (",b,")"]}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:P.expressPrice,onChange:e=>E(s=>({...s,expressPrice:e.target.value})),placeholder:"15.00 (leave empty to disable)"}),s.jsx("small",{children:"Leave empty if Express delivery is not available"})]}),s.jsxs("div",{className:"form-field",children:[s.jsxs("label",{children:["Normal Delivery Price (",b,")"]}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:P.normalPrice,onChange:e=>E(s=>({...s,normalPrice:e.target.value})),placeholder:"8.00 (leave empty to disable)"}),s.jsx("small",{children:"Leave empty if Normal delivery is not available"})]})]}),s.jsx("button",{type:"submit",className:"btn-primary",disabled:y,children:y?"Adding...":"Add Pricing Rule"})]})]}),s.jsxs("div",{className:"shipping-card",children:[s.jsx("h2",{children:"Current Pricing Rules"}),y?s.jsx("div",{className:"loading-state",children:"Loading pricing rules..."}):0===Object.keys($).length?s.jsxs("div",{className:"empty-state",children:[s.jsx("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:s.jsx("path",{d:"M14 20H34M14 28H34M10 10H38C39.1046 10 40 10.8954 40 12V36C40 37.1046 39.1046 38 38 38H10C8.89543 38 8 37.1046 8 36V12C8 10.8954 8.89543 10 10 10Z",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),s.jsx("p",{children:"No pricing rules set"}),s.jsxs("small",{children:["Add pricing rules for countries where you offer ",G," delivery"]})]}):s.jsx("div",{className:"pricing-grid",children:Object.entries($).map(([e,i])=>{var r;return s.jsxs("div",{className:"pricing-card",children:[s.jsxs("div",{className:"pricing-header",children:[s.jsx("h3",{children:(null==(r=w.find(s=>s.value===e))?void 0:r.label)||e}),s.jsx("span",{className:"country-code",children:e})]}),s.jsxs("div",{className:"pricing-details",children:[s.jsxs("div",{className:"price-row",children:[s.jsx("span",{className:"price-label",children:"âš¡ Express"}),s.jsx("span",{className:"price-amount",children:i.express&&parseFloat(i.express)>0?`${b}${parseFloat(i.express).toFixed(2)}`:"â€”"})]}),s.jsxs("div",{className:"price-row",children:[s.jsx("span",{className:"price-label",children:"ðŸ“¦ Normal"}),s.jsx("span",{className:"price-amount",children:i.normal&&parseFloat(i.normal)>0?`${b}${parseFloat(i.normal).toFixed(2)}`:"â€”"})]})]}),s.jsxs("button",{className:"btn-delete",onClick:()=>(async(e,s)=>{if(confirm(`Are you sure you want to delete pricing for ${e}?`)){v(!0);try{const i=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/pricing/${e}?type=${s}`,{method:"DELETE",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),r=await i.json();i.ok?(A("Pricing rule deleted successfully!","success"),S()):A(r.message||"Error deleting pricing rule","error")}catch(i){console.error("Error deleting pricing:",i),A("Error deleting pricing rule","error")}finally{v(!1)}}})(e,o),disabled:y,children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:s.jsx("path",{d:"M2 4H14M6 4V2H10V4M12 4V14H4V4H12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Delete"]})]},e)})})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Add New ",G," Pickup Location"]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k.name&&k.address&&k.city&&k.postalCode){v(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.directpayGoAdmin.restNonce},body:JSON.stringify({...k,type:o})}),s=await e.json();e.ok?(A("Location added successfully!","success"),S(),L({name:"",address:"",city:"",postalCode:"",country:"",type:o})):A(s.message||"Error adding location","error")}catch(s){console.error("Error adding location:",s),A("Error adding location","error")}finally{v(!1)}}else A("Please fill in all required fields","error")},className:"location-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Location Name *"}),s.jsx("input",{type:"text",value:k.name,onChange:e=>M("name",e.target.value),placeholder:"e.g., Paris Central Hub",required:!0})]}),s.jsxs("div",{className:"form-field",children:[s.jsx(n,{label:"Country *",options:C(),value:k.country,onChange:e=>M("country",e),searchable:!0,placeholder:C().length>0?"Search countries...":"No countries available - add pricing rules first",disabled:0===C().length}),0===C().length&&s.jsx("small",{style:{color:"#d63638",marginTop:"4px",display:"block"},children:'âš ï¸ Please add a pricing rule first in the "Pricing Rules" tab before adding locations'})]})]}),s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Address *"}),s.jsx("input",{type:"text",value:k.address,onChange:e=>M("address",e.target.value),placeholder:"123 Main Street",required:!0})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"City *"}),s.jsx("input",{type:"text",value:k.city,onChange:e=>M("city",e.target.value),placeholder:"Paris",required:!0})]}),s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Postal Code *"}),s.jsx("input",{type:"text",value:k.postalCode,onChange:e=>M("postalCode",e.target.value),placeholder:"75001",required:!0})]})]}),s.jsx("button",{type:"submit",className:"btn-primary",disabled:y,children:y?"Adding...":`Add ${G} Location`})]})]}),s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Existing ",G," Locations"]}),y?s.jsx("div",{className:"loading-state",children:"Loading locations..."}):0===V.length?s.jsxs("div",{className:"empty-state",children:[s.jsx("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:s.jsx("path",{d:"M24 6L8 16V32L24 42L40 32V16L24 6Z",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),s.jsx("p",{children:"No locations added yet"}),s.jsxs("small",{children:["Add your first ",G," pickup location above"]})]}):s.jsx("div",{className:"locations-grid",children:V.map(e=>s.jsxs("div",{className:"location-card",children:[s.jsxs("div",{className:"location-header",children:[s.jsx("h3",{children:e.name}),s.jsx("span",{className:"location-country",children:e.country})]}),s.jsxs("div",{className:"location-address",children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[s.jsx("path",{d:"M8 14C8 14 14 10 14 6C14 2.68629 11.3137 1 8 1C4.68629 1 2 2.68629 2 6C2 10 8 14 8 14Z",stroke:"currentColor",strokeWidth:"2"}),s.jsx("circle",{cx:"8",cy:"6",r:"2",stroke:"currentColor",strokeWidth:"2"})]}),s.jsxs("div",{children:[s.jsx("p",{children:e.address}),s.jsxs("p",{children:[e.postalCode," ",e.city]})]})]}),s.jsxs("button",{className:"btn-delete",onClick:()=>(async(e,s)=>{if(confirm("Are you sure you want to delete this location?")){v(!0);try{const i=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations/${e}?type=${s}`,{method:"DELETE",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),r=await i.json();i.ok?(A("Location deleted successfully!","success"),S()):A(r.message||"Error deleting location","error")}catch(i){console.error("Error deleting location:",i),A("Error deleting location","error")}finally{v(!1)}}})(e.id,o),disabled:y,children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:s.jsx("path",{d:"M2 4H14M6 4V2H10V4M12 4V14H4V4H12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Delete"]})]},e.id))})]})]})})]})},o=document.getElementById("directpay-shipping-root");if(o){i(o).render(s.jsx(r.StrictMode,{children:s.jsx(a,{})}))}
