import{r as e,j as s,a as i,R as r}from"./client-C4Hiuctl.js";import{C as n}from"./CustomDropdown-0EZoAZdu.js";const a=()=>{var i,r,a,o;const[l,t]=e.useState("chronopost"),[c,d]=e.useState("pricing"),[p,h]=e.useState([]),[m,u]=e.useState([]),[x,g]=e.useState({}),[j,y]=e.useState({}),[v,f]=e.useState(!1),[N,w]=e.useState(null),b=(null==(i=window.directpayGoAdmin)?void 0:i.countries)||[],C=(null==(r=window.directpayGoAdmin)?void 0:r.currencySymbol)||"â‚¬",[k,L]=e.useState({name:"",address:"",city:"",postalCode:"",country:(null==(a=b[0])?void 0:a.value)||"FR",type:"chronopost"}),[P,E]=e.useState({country:(null==(o=b[0])?void 0:o.value)||"FR",expressPrice:"",normalPrice:""});e.useEffect(()=>{S()},[]);const S=async()=>{f(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations`,{method:"GET",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),s=await e.json();h(s.chronopost||[]),u(s.mondial_relay||[]),g(s.chronopost_pricing||{}),y(s.mondial_relay_pricing||{})}catch(e){console.error("Error loading locations:",e),A("Error loading locations","error")}finally{f(!1)}},A=(e,s="success")=>{w({message:e,type:s}),setTimeout(()=>w(null),3e3)},M=(e,s)=>{L(i=>({...i,[e]:s}))},V="chronopost"===l?p:m,$="chronopost"===l?x:j,G="chronopost"===l?"Chronopost":"Mondial Relay";return s.jsxs("div",{className:"shipping-manager",children:[N&&s.jsx("div",{className:`shipping-notification ${N.type}`,children:N.message}),s.jsxs("div",{className:"shipping-header",children:[s.jsx("h1",{children:"Shipping Management"}),s.jsx("p",{children:"Manage pricing rules and pickup locations for Chronopost and Mondial Relay"})]}),s.jsxs("div",{className:"shipping-tabs",children:[s.jsxs("button",{className:"shipping-tab "+("chronopost"===l?"active":""),onClick:()=>t("chronopost"),children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:s.jsx("path",{d:"M10 2L3 7V13L10 18L17 13V7L10 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Chronopost"]}),s.jsxs("button",{className:"shipping-tab "+("mondial-relay"===l?"active":""),onClick:()=>t("mondial-relay"),children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:s.jsx("path",{d:"M10 2L3 7V13L10 18L17 13V7L10 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Mondial Relay"]})]}),s.jsxs("div",{className:"shipping-section-tabs",children:[s.jsx("button",{className:"section-tab "+("pricing"===c?"active":""),onClick:()=>d("pricing"),children:"Pricing Rules"}),s.jsx("button",{className:"section-tab "+("locations"===c?"active":""),onClick:()=>d("locations"),children:"Pickup Locations"})]}),s.jsx("div",{className:"shipping-content",children:"pricing"===c?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Set Pricing Rules for ",G]}),s.jsx("p",{className:"section-description",children:"Define Express and Normal delivery prices per country. These prices will apply to all pickup locations in that country."}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P.expressPrice||P.normalPrice){f(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/pricing`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.directpayGoAdmin.restNonce},body:JSON.stringify({...P,type:l})}),s=await e.json();e.ok?(A("Pricing rule added successfully!","success"),S(),E({country:"FR",expressPrice:"",normalPrice:""})):A(s.message||"Error adding pricing rule","error")}catch(s){console.error("Error adding pricing:",s),A("Error adding pricing rule","error")}finally{f(!1)}}else A("Please set at least one delivery price (Express or Normal)","error")},className:"pricing-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsx("div",{className:"form-field",children:s.jsx(n,{label:"Country *",options:b,value:P.country,onChange:e=>E(s=>({...s,country:e})),searchable:!0,placeholder:"Search countries..."})}),s.jsxs("div",{className:"form-field",children:[s.jsxs("label",{children:["Express Delivery Price (",C,")"]}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:P.expressPrice,onChange:e=>E(s=>({...s,expressPrice:e.target.value})),placeholder:"15.00 (leave empty to disable)"}),s.jsx("small",{children:"Leave empty if Express delivery is not available"})]}),s.jsxs("div",{className:"form-field",children:[s.jsxs("label",{children:["Normal Delivery Price (",C,")"]}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:P.normalPrice,onChange:e=>E(s=>({...s,normalPrice:e.target.value})),placeholder:"8.00 (leave empty to disable)"}),s.jsx("small",{children:"Leave empty if Normal delivery is not available"})]})]}),s.jsx("button",{type:"submit",className:"btn-primary",disabled:v,children:v?"Adding...":"Add Pricing Rule"})]})]}),s.jsxs("div",{className:"shipping-card",children:[s.jsx("h2",{children:"Current Pricing Rules"}),v?s.jsx("div",{className:"loading-state",children:"Loading pricing rules..."}):0===Object.keys($).length?s.jsxs("div",{className:"empty-state",children:[s.jsx("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:s.jsx("path",{d:"M14 20H34M14 28H34M10 10H38C39.1046 10 40 10.8954 40 12V36C40 37.1046 39.1046 38 38 38H10C8.89543 38 8 37.1046 8 36V12C8 10.8954 8.89543 10 10 10Z",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),s.jsx("p",{children:"No pricing rules set"}),s.jsxs("small",{children:["Add pricing rules for countries where you offer ",G," delivery"]})]}):s.jsx("div",{className:"pricing-grid",children:Object.entries($).map(([e,i])=>{var r;return s.jsxs("div",{className:"pricing-card",children:[s.jsxs("div",{className:"pricing-header",children:[s.jsx("h3",{children:(null==(r=b.find(s=>s.value===e))?void 0:r.label)||e}),s.jsx("span",{className:"country-code",children:e})]}),s.jsxs("div",{className:"pricing-details",children:[s.jsxs("div",{className:"price-row",children:[s.jsx("span",{className:"price-label",children:"âš¡ Express"}),s.jsx("span",{className:"price-amount",children:i.express&&parseFloat(i.express)>0?`${C}${parseFloat(i.express).toFixed(2)}`:"â€”"})]}),s.jsxs("div",{className:"price-row",children:[s.jsx("span",{className:"price-label",children:"ðŸ“¦ Normal"}),s.jsx("span",{className:"price-amount",children:i.normal&&parseFloat(i.normal)>0?`${C}${parseFloat(i.normal).toFixed(2)}`:"â€”"})]})]}),s.jsxs("button",{className:"btn-delete",onClick:()=>(async(e,s)=>{if(confirm(`Are you sure you want to delete pricing for ${e}?`)){f(!0);try{const i=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/pricing/${e}?type=${s}`,{method:"DELETE",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),r=await i.json();i.ok?(A("Pricing rule deleted successfully!","success"),S()):A(r.message||"Error deleting pricing rule","error")}catch(i){console.error("Error deleting pricing:",i),A("Error deleting pricing rule","error")}finally{f(!1)}}})(e,l),disabled:v,children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:s.jsx("path",{d:"M2 4H14M6 4V2H10V4M12 4V14H4V4H12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Delete"]})]},e)})})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Add New ",G," Pickup Location"]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k.name&&k.address&&k.city&&k.postalCode){f(!0);try{const e=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.directpayGoAdmin.restNonce},body:JSON.stringify({...k,type:l})}),s=await e.json();e.ok?(A("Location added successfully!","success"),S(),L({name:"",address:"",city:"",postalCode:"",country:"FR",type:l})):A(s.message||"Error adding location","error")}catch(s){console.error("Error adding location:",s),A("Error adding location","error")}finally{f(!1)}}else A("Please fill in all required fields","error")},className:"location-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Location Name *"}),s.jsx("input",{type:"text",value:k.name,onChange:e=>M("name",e.target.value),placeholder:"e.g., Paris Central Hub",required:!0})]}),s.jsx("div",{className:"form-field",children:s.jsx(n,{label:"Country *",options:b,value:k.country,onChange:e=>M("country",e),searchable:!0,placeholder:"Search countries..."})})]}),s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Address *"}),s.jsx("input",{type:"text",value:k.address,onChange:e=>M("address",e.target.value),placeholder:"123 Main Street",required:!0})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"City *"}),s.jsx("input",{type:"text",value:k.city,onChange:e=>M("city",e.target.value),placeholder:"Paris",required:!0})]}),s.jsxs("div",{className:"form-field",children:[s.jsx("label",{children:"Postal Code *"}),s.jsx("input",{type:"text",value:k.postalCode,onChange:e=>M("postalCode",e.target.value),placeholder:"75001",required:!0})]})]}),s.jsx("button",{type:"submit",className:"btn-primary",disabled:v,children:v?"Adding...":`Add ${G} Location`})]})]}),s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h2",{children:["Existing ",G," Locations"]}),v?s.jsx("div",{className:"loading-state",children:"Loading locations..."}):0===V.length?s.jsxs("div",{className:"empty-state",children:[s.jsx("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:s.jsx("path",{d:"M24 6L8 16V32L24 42L40 32V16L24 6Z",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),s.jsx("p",{children:"No locations added yet"}),s.jsxs("small",{children:["Add your first ",G," pickup location above"]})]}):s.jsx("div",{className:"locations-grid",children:V.map(e=>s.jsxs("div",{className:"location-card",children:[s.jsxs("div",{className:"location-header",children:[s.jsx("h3",{children:e.name}),s.jsx("span",{className:"location-country",children:e.country})]}),s.jsxs("div",{className:"location-address",children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[s.jsx("path",{d:"M8 14C8 14 14 10 14 6C14 2.68629 11.3137 1 8 1C4.68629 1 2 2.68629 2 6C2 10 8 14 8 14Z",stroke:"currentColor",strokeWidth:"2"}),s.jsx("circle",{cx:"8",cy:"6",r:"2",stroke:"currentColor",strokeWidth:"2"})]}),s.jsxs("div",{children:[s.jsx("p",{children:e.address}),s.jsxs("p",{children:[e.postalCode," ",e.city]})]})]}),s.jsxs("button",{className:"btn-delete",onClick:()=>(async(e,s)=>{if(confirm("Are you sure you want to delete this location?")){f(!0);try{const i=await fetch(`${window.directpayGoAdmin.restUrl}directpay/v1/shipping/locations/${e}?type=${s}`,{method:"DELETE",credentials:"same-origin",headers:{"X-WP-Nonce":window.directpayGoAdmin.restNonce}}),r=await i.json();i.ok?(A("Location deleted successfully!","success"),S()):A(r.message||"Error deleting location","error")}catch(i){console.error("Error deleting location:",i),A("Error deleting location","error")}finally{f(!1)}}})(e.id,l),disabled:v,children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:s.jsx("path",{d:"M2 4H14M6 4V2H10V4M12 4V14H4V4H12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Delete"]})]},e.id))})]})]})})]})},o=document.getElementById("directpay-shipping-root");if(o){i(o).render(s.jsx(r.StrictMode,{children:s.jsx(a,{})}))}
